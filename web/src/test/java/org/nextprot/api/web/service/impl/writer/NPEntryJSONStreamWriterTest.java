package org.nextprot.api.web.service.impl.writer;

import org.junit.Test;
import org.nextprot.api.web.dbunit.base.mvc.WebIntegrationBaseTest;
import org.skyscreamer.jsonassert.JSONAssert;

import java.io.ByteArrayOutputStream;
import java.util.Arrays;

public class NPEntryJSONStreamWriterTest extends WebIntegrationBaseTest {

    @Test
    public void testJSONExportStream() throws Exception {

        ByteArrayOutputStream out = new ByteArrayOutputStream();

        NPEntryOutputStreamWriter exporter = new NPEntryJSONStreamWriter(out, "overview");

        exporter.write(Arrays.asList("NX_P06213", "NX_P01308"));
        String output = out.toString();

        JSONAssert.assertEquals("{\"properties\":{\"proteinExistence\":\"Evidence at protein level\",\"ptmCount\":49,\"varCount\":280,\"isoformCount\":2,\"mutagenesisCount\":1,\"interactionCount\":51,\"maxSeqLen\":1382,\"filterstructure\":true,\"filterdisease\":true,\"filtermutagenesis\":true,\"filterproteomics\":true,\"filterexpressionprofile\":true,\"referencesCount\":414,\"referencesSubmissionsCount\":3,\"referencesAdditionalPublicationsCount\":206,\"referencesCuratedPublicationsCount\":204,\"referencesWebResourcesCount\":1,\"referencesPatentsCount\":0},\"uniqueName\":\"NX_P06213\",\"overview\":{\"history\":{\"proteinExistence\":\"Evidence_at_protein_level\",\"nextprotIntegrationDate\":1269233503237,\"nextprotUpdateDate\":1441548192908,\"uniprotIntegrationDate\":568029600000,\"uniprotUpdateDate\":1442397600000,\"uniprotVersion\":\"217\",\"lastSequenceUpdate\":\"2010-10-05\",\"sequenceVersion\":\"4\",\"proteinExistenceLevel\":1,\"proteinExistenceRaw\":\"protein level\",\"formattedNextprotIntegrationDate\":\"2010-03-22\",\"formattedNextprotUpdateDate\":\"2015-09-06\",\"formattedUniprotIntegrationDate\":\"1988-01-01\",\"formattedUniprotUpdateDate\":\"2015-09-16\"},\"families\":[{\"familyId\":67489,\"accession\":\"FA-03128\",\"name\":\"Insulin receptor\",\"level\":\"Subfamily\",\"description\":\"Belongs to the protein kinase superfamily. Tyr protein kinase family. Insulin receptor subfamily.\",\"region\":null,\"parent\":{\"familyId\":67478,\"accession\":\"FA-03117\",\"name\":\"Tyr protein kinase\",\"level\":\"Family\",\"description\":null,\"region\":null,\"parent\":{\"familyId\":67418,\"accession\":\"FA-03057\",\"name\":\"Protein kinase\",\"level\":\"Superfamily\",\"description\":null,\"region\":null,\"parent\":null}}}],\"proteinNames\":[{\"clazz\":\"PROTEIN_NAMES\",\"type\":\"name\",\"qualifier\":\"full\",\"id\":\"PR_888984\",\"category\":\"protein\",\"name\":\"Insulin receptor\",\"parentId\":null,\"mainEntityName\":null,\"synonyms\":[{\"clazz\":\"PROTEIN_NAMES\",\"type\":\"name\",\"qualifier\":\"short\",\"id\":\"PR_888983\",\"category\":\"protein\",\"name\":\"IR\",\"parentId\":\"PR_888984\",\"mainEntityName\":null,\"synonyms\":null,\"value\":\"IR\",\"main\":false,\"composedName\":\"short name\"},{\"clazz\":\"PROTEIN_NAMES\",\"type\":\"enzyme name\",\"qualifier\":\"EC\",\"id\":\"PR_2472057\",\"category\":\"EC\",\"name\":\"2.7.10.1\",\"parentId\":\"PR_888984\",\"mainEntityName\":null,\"synonyms\":null,\"value\":\"2.7.10.1\",\"main\":true,\"composedName\":\"EC enzyme name\"}],\"value\":\"Insulin receptor\",\"main\":true,\"composedName\":\"full name\"}],\"geneNames\":[{\"clazz\":\"GENE_NAMES\",\"type\":\"gene name\",\"qualifier\":null,\"id\":\"PR_1171491\",\"category\":\"gene name\",\"name\":\"INSR\",\"parentId\":null,\"mainEntityName\":null,\"synonyms\":null,\"value\":\"INSR\",\"main\":true,\"composedName\":\"gene name\"}],\"functionalRegionNames\":null,\"cleavedRegionNames\":[{\"clazz\":\"CLEAVED_REGION_NAMES\",\"type\":\"name\",\"qualifier\":\"full\",\"id\":\"MP_10136402\",\"category\":\"protein\",\"name\":\"Insulin receptor subunit alpha\",\"parentId\":null,\"mainEntityName\":null,\"synonyms\":null,\"value\":\"Insulin receptor subunit alpha\",\"main\":true,\"composedName\":\"full name\"},{\"clazz\":\"CLEAVED_REGION_NAMES\",\"type\":\"name\",\"qualifier\":\"full\",\"id\":\"MP_10136403\",\"category\":\"protein\",\"name\":\"Insulin receptor subunit beta\",\"parentId\":null,\"mainEntityName\":null,\"synonyms\":null,\"value\":\"Insulin receptor subunit beta\",\"main\":true,\"composedName\":\"full name\"}],\"additionalNames\":[{\"clazz\":\"ADDITIONAL_NAMES\",\"type\":\"CD antigen\",\"qualifier\":\"CD antigen\",\"id\":\"PR_888982\",\"category\":\"CD antigen\",\"name\":\"CD220\",\"parentId\":null,\"mainEntityName\":null,\"synonyms\":null,\"value\":\"CD220\",\"main\":false,\"composedName\":\"CD antigen CD antigen\"}],\"isoformNames\":[{\"clazz\":null,\"type\":\"name\",\"qualifier\":null,\"id\":null,\"category\":null,\"name\":\"Short\",\"parentId\":null,\"mainEntityName\":null,\"synonyms\":[{\"clazz\":null,\"type\":null,\"qualifier\":null,\"id\":null,\"category\":null,\"name\":\"HIR-A\",\"parentId\":null,\"mainEntityName\":null,\"synonyms\":null,\"value\":\"HIR-A\",\"main\":false,\"composedName\":null}],\"value\":\"Short\",\"main\":true,\"composedName\":\"name\"},{\"clazz\":null,\"type\":\"name\",\"qualifier\":null,\"id\":null,\"category\":null,\"name\":\"Long\",\"parentId\":null,\"mainEntityName\":null,\"synonyms\":[{\"clazz\":null,\"type\":null,\"qualifier\":null,\"id\":null,\"category\":null,\"name\":\"HIR-B\",\"parentId\":null,\"mainEntityName\":null,\"synonyms\":null,\"value\":\"HIR-B\",\"main\":false,\"composedName\":null}],\"value\":\"Long\",\"main\":true,\"composedName\":\"name\"}],\"proteinExistence\":\"Evidence_at_protein_level\",\"proteinExistenceLevel\":1,\"recommendedProteinName\":{\"clazz\":\"PROTEIN_NAMES\",\"type\":\"name\",\"qualifier\":\"full\",\"id\":\"PR_888984\",\"category\":\"protein\",\"name\":\"Insulin receptor\",\"parentId\":null,\"mainEntityName\":null,\"synonyms\":[{\"clazz\":\"PROTEIN_NAMES\",\"type\":\"name\",\"qualifier\":\"short\",\"id\":\"PR_888983\",\"category\":\"protein\",\"name\":\"IR\",\"parentId\":\"PR_888984\",\"mainEntityName\":null,\"synonyms\":null,\"value\":\"IR\",\"main\":false,\"composedName\":\"short name\"},{\"clazz\":\"PROTEIN_NAMES\",\"type\":\"enzyme name\",\"qualifier\":\"EC\",\"id\":\"PR_2472057\",\"category\":\"EC\",\"name\":\"2.7.10.1\",\"parentId\":\"PR_888984\",\"mainEntityName\":null,\"synonyms\":null,\"value\":\"2.7.10.1\",\"main\":true,\"composedName\":\"EC enzyme name\"}],\"value\":\"Insulin receptor\",\"main\":true,\"composedName\":\"full name\"},\"alternativeProteinNames\":[{\"clazz\":\"ADDITIONAL_NAMES\",\"type\":\"CD antigen\",\"qualifier\":\"CD antigen\",\"id\":\"PR_888982\",\"category\":\"CD antigen\",\"name\":\"CD220\",\"parentId\":null,\"mainEntityName\":null,\"synonyms\":null,\"value\":\"CD220\",\"main\":false,\"composedName\":\"CD antigen CD antigen\"}],\"mainProteinName\":\"Insulin receptor\",\"mainGeneName\":\"INSR\"},\"uniprotName\":\"P06213\",\"proteinExistence\":\"Evidence_at_protein_level\",\"proteinExistenceLevel\":1} {\"properties\":{\"proteinExistence\":\"Evidence at protein level\",\"ptmCount\":3,\"varCount\":42,\"isoformCount\":1,\"mutagenesisCount\":0,\"interactionCount\":4,\"maxSeqLen\":110,\"filterstructure\":true,\"filterdisease\":true,\"filtermutagenesis\":false,\"filterproteomics\":true,\"filterexpressionprofile\":true,\"referencesCount\":615,\"referencesSubmissionsCount\":4,\"referencesAdditionalPublicationsCount\":533,\"referencesCuratedPublicationsCount\":78,\"referencesWebResourcesCount\":3,\"referencesPatentsCount\":0},\"uniqueName\":\"NX_P01308\",\"overview\":{\"history\":{\"proteinExistence\":\"Evidence_at_protein_level\",\"nextprotIntegrationDate\":1267464499678,\"nextprotUpdateDate\":1441543252072,\"uniprotIntegrationDate\":522324000000,\"uniprotUpdateDate\":1442397600000,\"uniprotVersion\":\"207\",\"lastSequenceUpdate\":\"1986-07-21\",\"sequenceVersion\":\"1\",\"proteinExistenceLevel\":1,\"proteinExistenceRaw\":\"protein level\",\"formattedNextprotIntegrationDate\":\"2010-03-01\",\"formattedNextprotUpdateDate\":\"2015-09-06\",\"formattedUniprotIntegrationDate\":\"1986-07-21\",\"formattedUniprotUpdateDate\":\"2015-09-16\"},\"families\":[{\"familyId\":66231,\"accession\":\"FA-01869\",\"name\":\"Insulin\",\"level\":\"Family\",\"description\":\"Belongs to the insulin family.\",\"region\":null,\"parent\":null}],\"proteinNames\":[{\"clazz\":\"PROTEIN_NAMES\",\"type\":\"name\",\"qualifier\":\"full\",\"id\":\"PR_720135\",\"category\":\"protein\",\"name\":\"Insulin\",\"parentId\":null,\"mainEntityName\":null,\"synonyms\":null,\"value\":\"Insulin\",\"main\":true,\"composedName\":\"full name\"}],\"geneNames\":[{\"clazz\":\"GENE_NAMES\",\"type\":\"gene name\",\"qualifier\":null,\"id\":\"PR_1171036\",\"category\":\"gene name\",\"name\":\"INS\",\"parentId\":null,\"mainEntityName\":null,\"synonyms\":null,\"value\":\"INS\",\"main\":true,\"composedName\":\"gene name\"}],\"functionalRegionNames\":null,\"cleavedRegionNames\":[{\"clazz\":\"CLEAVED_REGION_NAMES\",\"type\":\"name\",\"qualifier\":\"full\",\"id\":\"MP_10139154\",\"category\":\"protein\",\"name\":\"Insulin A chain\",\"parentId\":null,\"mainEntityName\":null,\"synonyms\":null,\"value\":\"Insulin A chain\",\"main\":true,\"composedName\":\"full name\"},{\"clazz\":\"CLEAVED_REGION_NAMES\",\"type\":\"name\",\"qualifier\":\"full\",\"id\":\"MP_10139153\",\"category\":\"protein\",\"name\":\"Insulin B chain\",\"parentId\":null,\"mainEntityName\":null,\"synonyms\":null,\"value\":\"Insulin B chain\",\"main\":true,\"composedName\":\"full name\"}],\"additionalNames\":null,\"isoformNames\":[{\"clazz\":null,\"type\":\"name\",\"qualifier\":null,\"id\":null,\"category\":null,\"name\":\"Iso 1\",\"parentId\":null,\"mainEntityName\":null,\"synonyms\":[],\"value\":\"Iso 1\",\"main\":true,\"composedName\":\"name\"}],\"proteinExistence\":\"Evidence_at_protein_level\",\"proteinExistenceLevel\":1,\"recommendedProteinName\":{\"clazz\":\"PROTEIN_NAMES\",\"type\":\"name\",\"qualifier\":\"full\",\"id\":\"PR_720135\",\"category\":\"protein\",\"name\":\"Insulin\",\"parentId\":null,\"mainEntityName\":null,\"synonyms\":null,\"value\":\"Insulin\",\"main\":true,\"composedName\":\"full name\"},\"alternativeProteinNames\":[],\"mainProteinName\":\"Insulin\",\"mainGeneName\":\"INS\"},\"uniprotName\":\"P01308\",\"proteinExistence\":\"Evidence_at_protein_level\",\"proteinExistenceLevel\":1}\n",output, true);
    }
}